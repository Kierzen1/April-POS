{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 64, "column": 0}, "map": {"version":3,"sources":["file:///D:/Projects/April-POS/src/lib/prisma.ts"],"sourcesContent":["import \"dotenv/config\"\r\nimport { PrismaClient } from '@prisma/client'\r\n\r\nconst prismaClientSingleton = () => {\r\n    return new PrismaClient({\r\n        // Using any cast to bypass version-specific type checks for constructor options\r\n        datasourceUrl: process.env.DATABASE_URL,\r\n    } as any)\r\n}\r\n\r\ntype PrismaClientSingleton = ReturnType<typeof prismaClientSingleton>\r\n\r\nconst globalForPrisma = globalThis as unknown as {\r\n    prisma: PrismaClientSingleton | undefined\r\n}\r\n\r\nconst prisma = globalForPrisma.prisma ?? prismaClientSingleton()\r\n\r\nexport default prisma\r\n\r\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,MAAM,wBAAwB;IAC1B,OAAO,IAAI,sMAAY,CAAC;QACpB,gFAAgF;QAChF,eAAe,QAAQ,GAAG,CAAC,YAAY;IAC3C;AACJ;AAIA,MAAM,kBAAkB;AAIxB,MAAM,SAAS,gBAAgB,MAAM,IAAI;uCAE1B;AAEf,wCAA2C,gBAAgB,MAAM,GAAG"}},
    {"offset": {"line": 86, "column": 0}, "map": {"version":3,"sources":["file:///D:/Projects/April-POS/src/lib/firebase-admin.ts"],"sourcesContent":["import * as admin from 'firebase-admin';\r\n\r\nconst privateKey = process.env.FIREBASE_PRIVATE_KEY;\r\nconst firebaseAdminConfig = {\r\n    projectId: process.env.FIREBASE_PROJECT_ID,\r\n    clientEmail: process.env.FIREBASE_CLIENT_EMAIL,\r\n    privateKey: privateKey ? privateKey.replace(/\\\\n/g, '\\n') : undefined,\r\n};\r\n\r\n// Use a global variable to persist the admin instance across HMR reloads\r\nconst globalForAdmin = global as unknown as { admin: typeof admin };\r\n\r\nif (!admin.apps.length) {\r\n    console.log(\"Initializing Firebase Admin SDK for project:\", firebaseAdminConfig.projectId);\r\n    try {\r\n        admin.initializeApp({\r\n            credential: admin.credential.cert(firebaseAdminConfig as any),\r\n            projectId: firebaseAdminConfig.projectId,\r\n        });\r\n        console.log(\"Firebase Admin SDK initialized successfully.\");\r\n    } catch (error) {\r\n        console.error(\"Critical: Failed to initialize Firebase Admin SDK\", error);\r\n    }\r\n}\r\n\r\nexport const adminDb = admin.firestore();\r\nexport const adminAuth = admin.auth();\r\nexport default admin;\r\n"],"names":[],"mappings":";;;;;;;;AAAA;;AAEA,MAAM,aAAa,QAAQ,GAAG,CAAC,oBAAoB;AACnD,MAAM,sBAAsB;IACxB,WAAW,QAAQ,GAAG,CAAC,mBAAmB;IAC1C,aAAa,QAAQ,GAAG,CAAC,qBAAqB;IAC9C,YAAY,aAAa,WAAW,OAAO,CAAC,QAAQ,QAAQ;AAChE;AAEA,yEAAyE;AACzE,MAAM;AAEN,IAAI,CAAC,oLAAM,IAAI,CAAC,MAAM,EAAE;IACpB,QAAQ,GAAG,CAAC,gDAAgD,oBAAoB,SAAS;IACzF,IAAI;QACA,oLAAM,aAAa,CAAC;YAChB,YAAY,oLAAM,UAAU,CAAC,IAAI,CAAC;YAClC,WAAW,oBAAoB,SAAS;QAC5C;QACA,QAAQ,GAAG,CAAC;IAChB,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,qDAAqD;IACvE;AACJ;AAEO,MAAM,UAAU,oLAAM,SAAS;AAC/B,MAAM,YAAY,oLAAM,IAAI;uCACpB"}},
    {"offset": {"line": 123, "column": 0}, "map": {"version":3,"sources":["file:///D:/Projects/April-POS/src/lib/migrate-to-firestore.ts"],"sourcesContent":["import prisma from \"./prisma\";\r\nimport { adminDb, adminAuth } from \"./firebase-admin\";\r\n\r\nexport async function migrateAllToFirestore() {\r\n    console.log(\"Starting Comprehensive Migration...\");\r\n    const results: any = {};\r\n\r\n    try {\r\n        // 1. Migrate Users\r\n        console.log(\"--- Migrating Users ---\");\r\n        const users = await prisma.user.findMany();\r\n        console.log(`Found ${users.length} users.`);\r\n\r\n        const userBatch = [];\r\n        for (const user of users) {\r\n            // 1a. Migrate to Firestore\r\n            await adminDb.collection(\"users\").doc(user.id).set({\r\n                name: user.name,\r\n                email: user.email,\r\n                password: user.password, // IMPORTANT: Missing in previous version\r\n                role: user.role,\r\n                isActive: user.isActive,\r\n                createdAt: user.createdAt,\r\n                updatedAt: user.updatedAt,\r\n            });\r\n\r\n            // 1b. Prepare for Auth Migration\r\n            // Note: Password migration from bcrypt is complex. \r\n            // We'll create users with a placeholder or attempt to import if we have hashes.\r\n            // For now, let's create them so they exist in Auth.\r\n            try {\r\n                await adminAuth.createUser({\r\n                    uid: user.id,\r\n                    email: user.email,\r\n                    displayName: user.name || \"\",\r\n                    // We don't set password here because it's hashed in DB.\r\n                    // Users will need to reset passwords or we can set a default.\r\n                });\r\n                console.log(`- Created Auth User: ${user.email}`);\r\n            } catch (authError: any) {\r\n                if (authError.code === 'auth/uid-already-exists' || authError.code === 'auth/email-already-exists') {\r\n                    console.log(`- Auth User already exists: ${user.email}`);\r\n                } else {\r\n                    console.error(`- Error creating Auth user ${user.email}:`, authError.message);\r\n                }\r\n            }\r\n        }\r\n        results.users = { count: users.length };\r\n\r\n        // 2. Migrate Products\r\n        console.log(\"--- Migrating Products ---\");\r\n        const products = await prisma.product.findMany();\r\n        console.log(`Found ${products.length} products.`);\r\n        for (const product of products) {\r\n            await adminDb.collection(\"products\").doc(product.id).set({\r\n                barcode: String(product.barcode),\r\n                name: String(product.name),\r\n                description: product.description || \"\",\r\n                price: Number(product.price),\r\n                stock: Number(product.stock),\r\n                lowStockThreshold: Number(product.lowStockThreshold),\r\n                category: product.category || \"General\",\r\n                image: product.image || \"\",\r\n                createdAt: product.createdAt,\r\n                updatedAt: product.updatedAt,\r\n            });\r\n            console.log(`- Migrated Product: ${product.name}`);\r\n        }\r\n        results.products = { count: products.length };\r\n\r\n        // 3. Migrate Transactions\r\n        console.log(\"--- Migrating Transactions ---\");\r\n        const transactions = await prisma.transaction.findMany({\r\n            include: { items: true }\r\n        });\r\n        console.log(`Found ${transactions.length} transactions.`);\r\n        for (const tx of transactions) {\r\n            // Write Transaction\r\n            await adminDb.collection(\"transactions\").doc(tx.id).set({\r\n                total: Number(tx.total),\r\n                cashierId: tx.cashierId,\r\n                createdAt: tx.createdAt,\r\n            });\r\n\r\n            // Write Transaction Items\r\n            for (const item of tx.items) {\r\n                await adminDb.collection(\"transaction_items\").doc(item.id).set({\r\n                    transactionId: tx.id,\r\n                    productId: item.productId,\r\n                    quantity: item.quantity,\r\n                    priceAtTime: Number(item.priceAtTime),\r\n                });\r\n            }\r\n            console.log(`- Migrated Transaction: ${tx.id}`);\r\n        }\r\n        results.transactions = { count: transactions.length };\r\n\r\n        console.log(\"SUCCESS: Full migration completed.\");\r\n        return { success: true, results };\r\n    } catch (error: any) {\r\n        console.error(\"Migration FAILED:\", error);\r\n        return { success: false, error: error.message };\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe;IAClB,QAAQ,GAAG,CAAC;IACZ,MAAM,UAAe,CAAC;IAEtB,IAAI;QACA,mBAAmB;QACnB,QAAQ,GAAG,CAAC;QACZ,MAAM,QAAQ,MAAM,iIAAM,CAAC,IAAI,CAAC,QAAQ;QACxC,QAAQ,GAAG,CAAC,CAAC,MAAM,EAAE,MAAM,MAAM,CAAC,OAAO,CAAC;QAE1C,MAAM,YAAY,EAAE;QACpB,KAAK,MAAM,QAAQ,MAAO;YACtB,2BAA2B;YAC3B,MAAM,4IAAO,CAAC,UAAU,CAAC,SAAS,GAAG,CAAC,KAAK,EAAE,EAAE,GAAG,CAAC;gBAC/C,MAAM,KAAK,IAAI;gBACf,OAAO,KAAK,KAAK;gBACjB,UAAU,KAAK,QAAQ;gBACvB,MAAM,KAAK,IAAI;gBACf,UAAU,KAAK,QAAQ;gBACvB,WAAW,KAAK,SAAS;gBACzB,WAAW,KAAK,SAAS;YAC7B;YAEA,iCAAiC;YACjC,oDAAoD;YACpD,gFAAgF;YAChF,oDAAoD;YACpD,IAAI;gBACA,MAAM,8IAAS,CAAC,UAAU,CAAC;oBACvB,KAAK,KAAK,EAAE;oBACZ,OAAO,KAAK,KAAK;oBACjB,aAAa,KAAK,IAAI,IAAI;gBAG9B;gBACA,QAAQ,GAAG,CAAC,CAAC,qBAAqB,EAAE,KAAK,KAAK,EAAE;YACpD,EAAE,OAAO,WAAgB;gBACrB,IAAI,UAAU,IAAI,KAAK,6BAA6B,UAAU,IAAI,KAAK,6BAA6B;oBAChG,QAAQ,GAAG,CAAC,CAAC,4BAA4B,EAAE,KAAK,KAAK,EAAE;gBAC3D,OAAO;oBACH,QAAQ,KAAK,CAAC,CAAC,2BAA2B,EAAE,KAAK,KAAK,CAAC,CAAC,CAAC,EAAE,UAAU,OAAO;gBAChF;YACJ;QACJ;QACA,QAAQ,KAAK,GAAG;YAAE,OAAO,MAAM,MAAM;QAAC;QAEtC,sBAAsB;QACtB,QAAQ,GAAG,CAAC;QACZ,MAAM,WAAW,MAAM,iIAAM,CAAC,OAAO,CAAC,QAAQ;QAC9C,QAAQ,GAAG,CAAC,CAAC,MAAM,EAAE,SAAS,MAAM,CAAC,UAAU,CAAC;QAChD,KAAK,MAAM,WAAW,SAAU;YAC5B,MAAM,4IAAO,CAAC,UAAU,CAAC,YAAY,GAAG,CAAC,QAAQ,EAAE,EAAE,GAAG,CAAC;gBACrD,SAAS,OAAO,QAAQ,OAAO;gBAC/B,MAAM,OAAO,QAAQ,IAAI;gBACzB,aAAa,QAAQ,WAAW,IAAI;gBACpC,OAAO,OAAO,QAAQ,KAAK;gBAC3B,OAAO,OAAO,QAAQ,KAAK;gBAC3B,mBAAmB,OAAO,QAAQ,iBAAiB;gBACnD,UAAU,QAAQ,QAAQ,IAAI;gBAC9B,OAAO,QAAQ,KAAK,IAAI;gBACxB,WAAW,QAAQ,SAAS;gBAC5B,WAAW,QAAQ,SAAS;YAChC;YACA,QAAQ,GAAG,CAAC,CAAC,oBAAoB,EAAE,QAAQ,IAAI,EAAE;QACrD;QACA,QAAQ,QAAQ,GAAG;YAAE,OAAO,SAAS,MAAM;QAAC;QAE5C,0BAA0B;QAC1B,QAAQ,GAAG,CAAC;QACZ,MAAM,eAAe,MAAM,iIAAM,CAAC,WAAW,CAAC,QAAQ,CAAC;YACnD,SAAS;gBAAE,OAAO;YAAK;QAC3B;QACA,QAAQ,GAAG,CAAC,CAAC,MAAM,EAAE,aAAa,MAAM,CAAC,cAAc,CAAC;QACxD,KAAK,MAAM,MAAM,aAAc;YAC3B,oBAAoB;YACpB,MAAM,4IAAO,CAAC,UAAU,CAAC,gBAAgB,GAAG,CAAC,GAAG,EAAE,EAAE,GAAG,CAAC;gBACpD,OAAO,OAAO,GAAG,KAAK;gBACtB,WAAW,GAAG,SAAS;gBACvB,WAAW,GAAG,SAAS;YAC3B;YAEA,0BAA0B;YAC1B,KAAK,MAAM,QAAQ,GAAG,KAAK,CAAE;gBACzB,MAAM,4IAAO,CAAC,UAAU,CAAC,qBAAqB,GAAG,CAAC,KAAK,EAAE,EAAE,GAAG,CAAC;oBAC3D,eAAe,GAAG,EAAE;oBACpB,WAAW,KAAK,SAAS;oBACzB,UAAU,KAAK,QAAQ;oBACvB,aAAa,OAAO,KAAK,WAAW;gBACxC;YACJ;YACA,QAAQ,GAAG,CAAC,CAAC,wBAAwB,EAAE,GAAG,EAAE,EAAE;QAClD;QACA,QAAQ,YAAY,GAAG;YAAE,OAAO,aAAa,MAAM;QAAC;QAEpD,QAAQ,GAAG,CAAC;QACZ,OAAO;YAAE,SAAS;YAAM;QAAQ;IACpC,EAAE,OAAO,OAAY;QACjB,QAAQ,KAAK,CAAC,qBAAqB;QACnC,OAAO;YAAE,SAAS;YAAO,OAAO,MAAM,OAAO;QAAC;IAClD;AACJ"}},
    {"offset": {"line": 241, "column": 0}, "map": {"version":3,"sources":["file:///D:/Projects/April-POS/src/app/api/migrate/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\r\nimport { migrateAllToFirestore } from \"@/lib/migrate-to-firestore\";\r\n\r\nexport async function GET() {\r\n    try {\r\n        const result = await migrateAllToFirestore();\r\n        return NextResponse.json(result);\r\n    } catch (error) {\r\n        return NextResponse.json({\r\n            success: false,\r\n            error: (error as Error).message\r\n        }, { status: 500 });\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe;IAClB,IAAI;QACA,MAAM,SAAS,MAAM,IAAA,mKAAqB;QAC1C,OAAO,gJAAY,CAAC,IAAI,CAAC;IAC7B,EAAE,OAAO,OAAO;QACZ,OAAO,gJAAY,CAAC,IAAI,CAAC;YACrB,SAAS;YACT,OAAO,AAAC,MAAgB,OAAO;QACnC,GAAG;YAAE,QAAQ;QAAI;IACrB;AACJ"}}]
}