{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 22, "column": 0}, "map": {"version":3,"sources":["file:///D:/Projects/April-POS/src/lib/prisma.ts"],"sourcesContent":["import \"dotenv/config\"\r\nimport { PrismaClient } from '@prisma/client'\r\n\r\nconst prismaClientSingleton = () => {\r\n    return new PrismaClient({\r\n        // Using any cast to bypass version-specific type checks for constructor options\r\n        datasourceUrl: process.env.DATABASE_URL,\r\n    } as any)\r\n}\r\n\r\ntype PrismaClientSingleton = ReturnType<typeof prismaClientSingleton>\r\n\r\nconst globalForPrisma = globalThis as unknown as {\r\n    prisma: PrismaClientSingleton | undefined\r\n}\r\n\r\nconst prisma = globalForPrisma.prisma ?? prismaClientSingleton()\r\n\r\nexport default prisma\r\n\r\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,MAAM,wBAAwB;IAC1B,OAAO,IAAI,sMAAY,CAAC;QACpB,gFAAgF;QAChF,eAAe,QAAQ,GAAG,CAAC,YAAY;IAC3C;AACJ;AAIA,MAAM,kBAAkB;AAIxB,MAAM,SAAS,gBAAgB,MAAM,IAAI;uCAE1B;AAEf,wCAA2C,gBAAgB,MAAM,GAAG"}},
    {"offset": {"line": 44, "column": 0}, "map": {"version":3,"sources":["file:///D:/Projects/April-POS/src/lib/actions.ts"],"sourcesContent":["\"use server\";\r\n\r\nimport prisma from \"@/lib/prisma\";\r\nimport bcrypt from \"bcryptjs\";\r\nimport { z } from \"zod\";\r\nimport { Prisma } from \"@prisma/client\";\r\n\r\nconst registerSchema = z.object({\r\n    name: z.string().min(2, \"Name is too short\"),\r\n    email: z.string().email(\"Invalid email\"),\r\n    password: z.string().min(6, \"Password must be at least 6 characters\"),\r\n});\r\n\r\nexport async function registerUser(formData: FormData) {\r\n    const name = formData.get(\"name\") as string;\r\n    const email = formData.get(\"email\") as string;\r\n    const password = formData.get(\"password\") as string;\r\n\r\n    const validated = registerSchema.safeParse({ name, email, password });\r\n\r\n    if (!validated.success) {\r\n        return { error: validated.error.issues[0]?.message || \"Validation failed\" };\r\n    }\r\n\r\n    try {\r\n        const existingUser = await prisma.user.findUnique({\r\n            where: { email },\r\n        });\r\n\r\n        if (existingUser) {\r\n            return { error: \"User already exists\" };\r\n        }\r\n\r\n        const hashedPassword = await bcrypt.hash(password, 10);\r\n\r\n        // First user created in the system should be an ADMIN and ACTIVE\r\n        const userCount = await prisma.user.count();\r\n        const role = userCount === 0 ? \"ADMIN\" : \"STAFF\";\r\n        const isActive = userCount === 0;\r\n\r\n        await prisma.user.create({\r\n            data: {\r\n                name,\r\n                email,\r\n                password: hashedPassword,\r\n                role,\r\n                isActive,\r\n            },\r\n        });\r\n\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error(\"Registration error:\", error);\r\n        return { error: \"Something went wrong\" };\r\n    }\r\n}\r\n\r\nconst adminCreateUserSchema = z.object({\r\n    name: z.string().min(2, \"Name is too short\"),\r\n    email: z.string().email(\"Invalid email\"),\r\n    password: z.string().min(6, \"Password must be at least 6 characters\"),\r\n    role: z.enum([\"ADMIN\", \"STAFF\"]),\r\n});\r\n\r\nexport async function adminCreateUser(formData: FormData) {\r\n    const name = formData.get(\"name\") as string;\r\n    const email = formData.get(\"email\") as string;\r\n    const password = formData.get(\"password\") as string;\r\n    const role = formData.get(\"role\") as \"ADMIN\" | \"STAFF\";\r\n\r\n    const validated = adminCreateUserSchema.safeParse({ name, email, password, role });\r\n\r\n    if (!validated.success) {\r\n        return { error: validated.error.issues[0]?.message || \"Validation failed\" };\r\n    }\r\n\r\n    try {\r\n        const existingUser = await prisma.user.findUnique({\r\n            where: { email },\r\n        });\r\n\r\n        if (existingUser) {\r\n            return { error: \"User already exists\" };\r\n        }\r\n\r\n        const hashedPassword = await bcrypt.hash(password, 10);\r\n\r\n        await prisma.user.create({\r\n            data: {\r\n                name,\r\n                email,\r\n                password: hashedPassword,\r\n                role,\r\n                isActive: true, // Admin-created users are active by default\r\n            },\r\n        });\r\n\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error(\"Admin user creation error:\", error);\r\n        return { error: \"Something went wrong\" };\r\n    }\r\n}\r\n\r\n// User Management\r\nexport async function getUsers() {\r\n    return await prisma.user.findMany({\r\n        orderBy: { createdAt: \"desc\" },\r\n    });\r\n}\r\n\r\nexport async function toggleUserActivation(userId: string) {\r\n    const user = await prisma.user.findUnique({ where: { id: userId } });\r\n    if (!user) return { error: \"User not found\" };\r\n\r\n    await prisma.user.update({\r\n        where: { id: userId },\r\n        data: { isActive: !user.isActive },\r\n    });\r\n\r\n    return { success: true };\r\n}\r\n\r\n// Product Management\r\nexport async function getProducts() {\r\n    const products = await prisma.product.findMany({\r\n        include: {\r\n            items: {\r\n                select: {\r\n                    quantity: true\r\n                }\r\n            }\r\n        },\r\n        orderBy: { updatedAt: \"desc\" },\r\n    });\r\n\r\n    // Convert Decimal to number and calculate sold count\r\n    return products.map((p: any) => {\r\n        const soldCount = p.items.reduce((sum: number, item: any) => sum + item.quantity, 0);\r\n        return {\r\n            ...p,\r\n            price: Number(p.price),\r\n            soldCount,\r\n            items: undefined // Remove items array to keep object clean\r\n        };\r\n    });\r\n}\r\n\r\nexport async function getLowStockCount() {\r\n    const products = await prisma.product.findMany({\r\n        select: {\r\n            id: true,\r\n            name: true,\r\n            stock: true,\r\n            lowStockThreshold: true,\r\n        }\r\n    });\r\n\r\n    const lowStockItems = products.filter(p => p.stock <= (p.lowStockThreshold || 5));\r\n    return {\r\n        count: lowStockItems.length,\r\n        items: lowStockItems\r\n    };\r\n}\r\n\r\nexport async function getProductByBarcode(barcode: string) {\r\n    const trimmedBarcode = barcode.trim();\r\n    const product = await prisma.product.findUnique({\r\n        where: { barcode: trimmedBarcode },\r\n        include: {\r\n            items: {\r\n                select: {\r\n                    quantity: true\r\n                }\r\n            }\r\n        }\r\n    });\r\n\r\n    if (!product) return null;\r\n\r\n    const soldCount = (product as any).items.reduce((sum: number, item: any) => sum + item.quantity, 0);\r\n\r\n    return {\r\n        ...product,\r\n        price: Number(product.price),\r\n        soldCount,\r\n        items: undefined\r\n    };\r\n}\r\n\r\nexport async function upsertProduct(data: any) {\r\n    const { id, barcode, name, price, stock, lowStockThreshold, category, image } = data;\r\n    const parsedPrice = new Prisma.Decimal(parseFloat(price) || 0);\r\n    const parsedStock = parseInt(stock) || 0;\r\n    const parsedThreshold = parseInt(lowStockThreshold) || 5;\r\n\r\n    if (id) {\r\n        await prisma.product.update({\r\n            where: { id },\r\n            data: {\r\n                barcode,\r\n                name,\r\n                price: parsedPrice,\r\n                stock: parsedStock,\r\n                lowStockThreshold: parsedThreshold,\r\n                category,\r\n                image\r\n            },\r\n        });\r\n    } else {\r\n        await prisma.product.create({\r\n            data: {\r\n                barcode,\r\n                name,\r\n                price: parsedPrice,\r\n                stock: parsedStock,\r\n                lowStockThreshold: parsedThreshold,\r\n                category,\r\n                image\r\n            },\r\n        });\r\n    }\r\n\r\n    return { success: true };\r\n}\r\n\r\nexport async function deleteProduct(id: string) {\r\n    await prisma.product.delete({ where: { id } });\r\n    return { success: true };\r\n}\r\n\r\n// Transaction Management\r\nexport async function completeSale(cashierId: string, items: any[], total: number) {\r\n    try {\r\n        await prisma.$transaction(async (tx: any) => {\r\n            // 1. Create Transaction\r\n            await tx.transaction.create({\r\n                data: {\r\n                    cashierId,\r\n                    total,\r\n                    items: {\r\n                        create: items.map(item => ({\r\n                            productId: item.productId,\r\n                            quantity: item.quantity,\r\n                            priceAtTime: item.price\r\n                        }))\r\n                    }\r\n                }\r\n            });\r\n\r\n            // 2. Update Stocks\r\n            for (const item of items) {\r\n                await tx.product.update({\r\n                    where: { id: item.productId },\r\n                    data: {\r\n                        stock: {\r\n                            decrement: item.quantity\r\n                        }\r\n                    }\r\n                });\r\n            }\r\n        });\r\n\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error(\"Sale error:\", error);\r\n        return { error: \"Failed to complete sale\" };\r\n    }\r\n}\r\n\r\nexport async function getTransactions() {\r\n    const transactions = await prisma.transaction.findMany({\r\n        include: {\r\n            cashier: true,\r\n            items: {\r\n                include: {\r\n                    product: true\r\n                }\r\n            }\r\n        },\r\n        orderBy: { createdAt: \"desc\" }\r\n    });\r\n\r\n    return transactions.map((tx: any) => ({\r\n        ...tx,\r\n        total: Number(tx.total),\r\n        items: tx.items.map((item: any) => ({\r\n            ...item,\r\n            priceAtTime: Number(item.priceAtTime),\r\n            product: item.product ? {\r\n                ...item.product,\r\n                price: Number(item.product.price)\r\n            } : null\r\n        }))\r\n    }));\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 423, "column": 0}, "map": {"version":3,"sources":["file:///D:/Projects/April-POS/.next-internal/server/app/admin/products/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {getLowStockCount as '00b7da2130fcff59e6ef4e2860acc4be0dc7f333a5'} from 'ACTIONS_MODULE0'\nexport {getProducts as '00df78ebb5383cb59f76e1fec79847930b21c1e633'} from 'ACTIONS_MODULE0'\nexport {upsertProduct as '40eea97e91cf7ed8cacdab14034cf02133cea0b866'} from 'ACTIONS_MODULE0'\nexport {deleteProduct as '403e3f9c60d3a714533fe1cfb72328b31492e38e5d'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA"}}]
}